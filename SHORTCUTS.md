# Neovim キーマップ一覧

このドキュメントは、Neovim設定で定義されているカスタムキーマップをまとめたものです。

## 目次

1. [クイックリファレンス](#クイックリファレンス)
2. [基本操作](#基本操作)
3. [ファイル操作](#ファイル操作)
4. [コード編集](#コード編集)
5. [LSP・診断](#lsp診断)
6. [テスト実行](#テスト実行)
7. [Git操作](#git操作)
8. [AI アシスタント](#ai-アシスタント)
9. [ターミナル](#ターミナル)
10. [ウィンドウ管理](#ウィンドウ管理)
11. [WezTerm](#wezterm)
12. [Zsh](#zsh)
13. [Lazygit](#lazygit)
14. [高度な機能](#高度な機能)

---

## クイックリファレンス

### 最もよく使うキーマップ

| キー         | 説明                     | モード |
| ------------ | ------------------------ | ------ |
| `<C-s>`      | ファイル保存             | n,i,v  |
| `<leader>e`  | ファイルエクスプローラー | n      |
| `<leader>ff` | ファイル検索             | n      |
| `<leader>fg` | テキスト検索             | n      |
| `<leader>fm` | フォーマット             | n,v    |
| `<leader>ca` | コードアクション         | n,v    |
| `<leader>tr` | テスト実行               | n      |
| `<leader>gg` | LazyGit                  | n      |
| `<C-\>`      | ターミナルトグル         | n,t    |
| `gd`         | 定義へジャンプ           | n      |

**注**: `<leader>` = スペースキー、モード: n=Normal, i=Insert, v=Visual, t=Terminal

---

## 基本操作

| キーマップ   | 説明                                 | モード |
| ------------ | ------------------------------------ | ------ |
| `<C-s>`      | ファイルを保存                       | n,i,v  |
| `<C-c>`      | ファイル全体をクリップボードにコピー | n      |
| `<leader>yp` | 絶対パスをコピー                     | n      |
| `<leader>yr` | 相対パスをコピー                     | n      |
| `<leader>yf` | ファイル名をコピー                   | n      |
| `<leader>qq` | Neovim終了                           | n      |

---

## ファイル操作

### ファイルエクスプローラー

| キーマップ   | 説明                         | モード |
| ------------ | ---------------------------- | ------ |
| `<leader>e`  | エクスプローラー（ルート）   | n      |
| `<leader>E`  | エクスプローラー（カレント） | n      |
| `<leader>fe` | ファイルエクスプローラー     | n      |

### 検索

| キーマップ   | 説明                             | モード |
| ------------ | -------------------------------- | ------ |
| `<leader>ff` | ファイル検索                     | n      |
| `<leader>sg` | Grep検索（プロジェクト全体）     | n      |
| `<leader>fw` | カーソル下の単語をGrep検索       | n      |
| `<leader>/`  | バッファ内検索（現在ファイル内） | n      |
| `<leader>fb` | バッファ検索                     | n      |
| `<leader>fh` | ヘルプタグ検索                   | n      |
| `<leader>fc` | 設定ファイル検索                 | n      |
| `<leader>fk` | キーマップ検索                   | n      |
| `<leader>fr` | 最近開いたファイル               | n      |
| `<leader>sr` | 検索と置換（Grug-far）           | n,v    |

**注**: `<leader>fg`はTelescope使用時のキーマップ。現在はSnacks.nvimを使用しているため`<leader>sg`を使用。

### バッファ操作

| キーマップ     | 説明               | モード |
| -------------- | ------------------ | ------ |
| `<S-h>` / `[b` | 前のバッファ       | n      |
| `<S-l>` / `]b` | 次のバッファ       | n      |
| `<leader>bb`   | バッファを切り替え | n      |
| `<leader>bd`   | バッファを削除     | n      |
| `<leader>bD`   | バッファを強制削除 | n      |

---

## コード編集

### フォーマット

| キーマップ   | 説明                            | モード |
| ------------ | ------------------------------- | ------ |
| `<leader>fm` | ファイル/選択範囲をフォーマット | n,v    |
| `<leader>cf` | コードフォーマット              | n,v    |

#### 自動フォーマットの制御

```vim
" バッファ単位で無効化/有効化
:lua vim.b.autoformat = false
:lua vim.b.autoformat = true

" グローバルで無効化/有効化
:lua vim.g.autoformat = false
:lua vim.g.autoformat = true

" トグルコマンド
:FormatToggle   " 現在バッファ
:FormatToggle!  " グローバル
```

### 文字ジャンプ・モーション

#### Flash.nvim（高速ジャンプ）

| キーマップ | 説明                          | モード |
| ---------- | ----------------------------- | ------ |
| `s`        | Flash（ラベルジャンプモード） | n,o,v  |
| `S`        | Treesitterベースのジャンプ    | n,o,v  |
| `r`        | リモートフラッシュ            | o      |
| `R`        | Treesitter検索                | n,o,v  |

**使い方**: `s`キーを押すと画面上の各位置にラベル（文字）が表示されます。そのラベルを入力すると瞬時にその位置にジャンプできます。

#### 従来のVimコマンド

| キーマップ | 説明                         | モード |
| ---------- | ---------------------------- | ------ |
| `f{char}`  | 文字を前方検索してジャンプ   | n      |
| `F{char}`  | 文字を後方検索してジャンプ   | n      |
| `t{char}`  | 文字の直前にジャンプ         | n      |
| `T{char}`  | 文字の直後にジャンプ         | n      |
| `;`        | 最後の検索を前方向に繰り返し | n      |
| `,`        | 最後の検索を逆方向に繰り返し | n      |

---

## LSP・診断

### LSP ナビゲーション

| キーマップ   | 説明             | モード |
| ------------ | ---------------- | ------ |
| `gd`         | 定義へジャンプ   | n      |
| `gr`         | 参照箇所を検索   | n      |
| `gI`         | 実装へジャンプ   | n      |
| `gy`         | 型定義へジャンプ | n      |
| `gD`         | 宣言へジャンプ   | n      |
| `K`          | ホバー情報表示   | n      |
| `gK`         | シグネチャヘルプ | n      |
| `<leader>ca` | コードアクション | n,v    |
| `<leader>cr` | リネーム         | n      |
| `<leader>cl` | LSP情報表示      | n      |

### 診断

| キーマップ          | 説明                                  | モード |
| ------------------- | ------------------------------------- | ------ |
| `gl` / `<leader>ld` | 行の診断を表示（2回入力でフォーカス） | n      |
| `<leader>cd`        | 診断を表示                            | n      |
| `[d`                | 前の診断へ移動                        | n      |
| `]d`                | 次の診断へ移動                        | n      |
| `[e`                | 前のエラーへ移動                      | n      |
| `]e`                | 次のエラーへ移動                      | n      |
| `<leader>dl`        | 診断をロケーションリストに追加        | n      |
| `<leader>dq`        | 診断をQuickfixリストに追加            | n      |

#### 診断フローティングウィンドウの操作

| キーマップ    | 説明                                 |
| ------------- | ------------------------------------ |
| `<C-w>w`      | フローティングウィンドウにフォーカス |
| `q` / `<Esc>` | フローティングウィンドウを閉じる     |

---

## テスト実行

### 基本操作

| キーマップ   | 説明                           | モード |
| ------------ | ------------------------------ | ------ |
| `<leader>tr` | カーソル位置のテストを実行     | n      |
| `<leader>tt` | 現在ファイルのテスト実行       | n      |
| `<leader>tT` | プロジェクト全体のテスト実行   | n      |
| `<leader>tl` | 最後のテストを再実行           | n      |
| `<leader>td` | カーソル位置のテストをデバッグ | n      |

### 拡張操作

| キーマップ   | 説明                         | モード |
| ------------ | ---------------------------- | ------ |
| `<leader>tp` | パッケージ単位でテスト実行   | n      |
| `<leader>tc` | カバレッジ測定付きテスト実行 | n      |
| `<leader>tC` | ファイル単位でカバレッジ測定 | n      |
| `<leader>tA` | レース検出付きテスト実行     | n      |

### 結果表示

| キーマップ   | 説明                         | モード |
| ------------ | ---------------------------- | ------ |
| `<leader>ts` | テスト結果サマリー表示       | n      |
| `<leader>to` | テスト出力を表示             | n      |
| `<leader>tO` | テスト出力パネル切り替え     | n      |
| `<leader>tS` | 実行中のテスト停止           | n      |
| `<leader>tw` | テストウォッチモード切り替え | n      |

**サポート言語**: Go（サブテスト、テーブルテスト、カバレッジ、レース検出対応）

---

## Git操作

| キーマップ   | 説明                    | モード |
| ------------ | ----------------------- | ------ |
| `<leader>gg` | LazyGit                 | n      |
| `<leader>gG` | LazyGit（ファイル履歴） | n      |
| `<leader>gl` | Gitグラフ表示           | n      |
| `<leader>gb` | Git blame               | n      |
| `<leader>gB` | Git browse              | n      |

---

## AI アシスタント

### GitHub Copilot

| キーマップ   | 説明                  | モード |
| ------------ | --------------------- | ------ |
| `<Tab>`      | 提案を受け入れ        | i      |
| `<M-l>`      | 次の単語を受け入れ    | i      |
| `<C-K>`      | 次の行を受け入れ      | i      |
| `<C-]>`      | 提案を拒否/キャンセル | i      |
| `<M-]>`      | 次の提案を表示        | i      |
| `<M-[>`      | 前の提案を表示        | i      |
| `<leader>cc` | CopilotChatを開く     | n      |
| `<leader>ct` | CopilotChatトグル     | n      |
| `<leader>cs` | CopilotChat停止       | n      |

#### 選択範囲での操作

| キーマップ   | 説明             | モード |
| ------------ | ---------------- | ------ |
| `<leader>cE` | コード説明       | v      |
| `<leader>cR` | コードレビュー   | v      |
| `<leader>cF` | 修正提案         | v      |
| `<leader>cO` | 最適化提案       | v      |
| `<leader>cD` | ドキュメント生成 | v      |
| `<leader>cT` | テストケース生成 | v      |

### Claude Code（v0.3.0対応・修正版）

#### 基本的なClaude操作

| キーマップ   | 説明                 | モード |
| ------------ | -------------------- | ------ |
| `<leader>ac` | Claude端末トグル     | n      |
| `<leader>af` | Claude端末フォーカス | n      |
| `<leader>ao` | Claude端末を開く     | n      |
| `<leader>aq` | Claude端末を閉じる   | n      |

#### Claude Code統合の制御

| キーマップ   | 説明                      | モード |
| ------------ | ------------------------- | ------ |
| `<leader>aI` | Claude Code統合開始       | n      |
| `<leader>aS` | Claude Code統合停止       | n      |
| `<leader>ai` | Claude Codeステータス表示 | n      |

#### ファイル・コンテキスト管理

| キーマップ   | 説明                       | モード |
| ------------ | -------------------------- | ------ |
| `<leader>ab` | 現在バッファをClaudeに追加             | n      |
| `<leader>as` | 選択範囲をClaudeに送信                 | v      |
| `<leader>at` | neo-treeからファイルをClaudeに追加     | n      |

#### Diff管理（v0.3.0新機能）

| キーマップ   | 説明               | モード |
| ------------ | ------------------ | ------ |
| `<leader>aa` | Diff変更を受け入れ | n      |
| `<leader>ad` | Diff変更を拒否     | n      |

---

## ターミナル

| キーマップ   | 説明                                  | モード |
| ------------ | ------------------------------------- | ------ |
| `<C-\>`      | ターミナルトグル                      | n,t    |
| `<leader>tf` | フローティングターミナル              | n      |
| `<leader>th` | 水平分割ターミナル                    | n      |
| `<leader>tv` | 垂直分割ターミナル                    | n      |
| `<leader>tg` | LazyGit（要: `brew install lazygit`） | n      |
| `<leader>tu` | GitUI（要: `brew install gitui`）     | n      |
| `<leader>tb` | Btop（要: `brew install btop`）       | n      |

---

## ウィンドウ管理

### ウィンドウ移動

| キーマップ | 説明                 | モード |
| ---------- | -------------------- | ------ |
| `<C-h>`    | 左のウィンドウへ移動 | n      |
| `<C-j>`    | 下のウィンドウへ移動 | n      |
| `<C-k>`    | 上のウィンドウへ移動 | n      |
| `<C-l>`    | 右のウィンドウへ移動 | n      |

### ウィンドウ操作

| キーマップ    | 説明                           | モード |
| ------------- | ------------------------------ | ------ |
| `<leader>wp`  | ウィンドウピッカーで移動       | n      |
| `<leader>w-`  | 水平分割                       | n      |
| `<leader>w\|` | 垂直分割                       | n      |
| `<leader>wd`  | ウィンドウを削除               | n      |
| `<leader>nn`  | No Neck Pain（中央寄せ）トグル | n      |

---

## WezTerm

### ペイン操作

| キーマップ           | 説明                     |
| -------------------- | ------------------------ |
| `Ctrl+q → h/l/k/j`   | ペインフォーカス移動     |
| `Ctrl+q → d`         | 垂直分割                 |
| `Ctrl+q → r`         | 水平分割                 |
| `Ctrl+q → x`         | ペイン閉じる             |
| `Ctrl+q → z`         | ペインズーム             |
| `Ctrl+q → c`         | ターミナルクリア         |
| `Ctrl+q → R`         | ペイン回転（時計回り）   |
| `Ctrl+q → Shift+R`   | ペイン回転（反時計回り） |
| `Ctrl+Shift+H/L/K/J` | ペインフォーカス即座移動 |
| `Ctrl+Shift+[`       | ペイン選択モード         |

### ペインナビゲーションモード（`Ctrl+q → q`）

| キーマップ      | 説明                 |
| --------------- | -------------------- |
| `h/l/k/j`       | ペインフォーカス移動 |
| `1-9`           | ペイン番号選択       |
| `Shift+H/L/K/J` | ペインサイズ調整     |
| `x`             | ペイン閉じる         |
| `z`             | ペインズーム         |
| `r`             | 時計回り回転         |
| `Shift+R`       | 反時計回り回転       |
| `Enter/Esc/q`   | モード終了           |

### 中央寄せ機能（no-neck-pain風）

| キーマップ         | 説明                                                |
| ------------------ | --------------------------------------------------- |
| `Ctrl+q → m`       | 中央寄せモードのオン/オフ切り替え                   |
| `Ctrl+q → M`       | プリセット切り替え（narrow/normal/wide/ultra_wide） |
| `Ctrl+q → -`       | 中央寄せ幅を狭くする（5%ずつ）                      |
| `Ctrl+q → Shift+-` | 中央寄せ幅を広くする（5%ずつ）※JISキーボード対応    |
| `Ctrl+q → ,`       | 最大幅を狭くする（100pxずつ）                       |
| `Ctrl+q → .`       | 最大幅を広くする（100pxずつ）                       |
| `Ctrl+q → f`       | フルスクリーン限定モードの切り替え                  |

**プリセット:**

- `narrow`: 50%幅、最大1000px
- `normal`: 60%幅、最大1400px（デフォルト）
- `wide`: 75%幅、最大1800px
- `ultra_wide`: 85%幅、最大2200px

### タブ操作

| キーマップ    | 説明         |
| ------------- | ------------ |
| `Cmd+t`       | 新タブ       |
| `Cmd+w`       | タブ閉じる   |
| `Cmd+Shift+]` | 次のタブ     |
| `Cmd+Shift+[` | 前のタブ     |
| `Cmd+1-9`     | タブ番号選択 |
| `Ctrl+q → {`  | タブ左移動   |
| `Ctrl+q → }`  | タブ右移動   |

### その他

| キーマップ         | 説明         |
| ------------------ | ------------ |
| `Cmd+c`            | コピー       |
| `Cmd+v`            | ペースト     |
| `Ctrl+q → [`       | コピーモード |
| `Ctrl+Shift+Space` | Quick Select |

### Copy Mode（`Ctrl+q → [`）

#### 移動・ナビゲーション

| キーマップ | 説明                     |
| ---------- | ------------------------ |
| `h/j/k/l`  | カーソル移動             |
| `w/b/e`    | 単語移動                 |
| `^/$`      | 行頭・行末移動           |
| `0`        | 行の最初の文字に移動     |
| `G/g`      | 最下・最上行移動         |
| `H/M/L`    | ビューポート上・中・下部 |

#### 選択・コピー

| キーマップ | 説明                 |
| ---------- | -------------------- |
| `v`        | 文字選択モード       |
| `V`        | 行選択モード         |
| `Ctrl+v`   | ブロック選択モード   |
| `y`        | 選択範囲をコピー     |
| `Enter`    | コピーしてモード終了 |

#### 検索機能

| キーマップ | 説明                       |
| ---------- | -------------------------- |
| `/`        | 前方検索開始               |
| `?`        | 後方検索開始               |
| `n`        | 次の検索結果               |
| `N`        | 前の検索結果               |
| `Escape`   | 検索とセレクションをクリア |

#### その他

| キーマップ | 説明             |
| ---------- | ---------------- |
| `q/[`      | コピーモード終了 |
| `Ctrl+c`   | コピーモード終了 |

### その他のWezTerm機能

| キーマップ     | 説明             |
| -------------- | ---------------- |
| `Cmd+p`        | コマンドパレット |
| `Ctrl+Shift+R` | 設定再読み込み   |
| `Ctrl++`       | フォント拡大     |
| `Ctrl+-`       | フォント縮小     |
| `Ctrl+0`       | フォントリセット |

**注**: リーダーキー（`Ctrl+q`）タイムアウト: 1000ms

---

## Zsh

| キーマップ | 説明                           |
| ---------- | ------------------------------ |
| `Ctrl+E`   | エディタ（nvim）でコマンド編集 |
| `Ctrl+P`   | 履歴前方検索（マッチ）         |
| `Ctrl+N`   | 履歴後方検索（マッチ）         |
| `Ctrl+Y`   | 現在単語のみ適用               |
| `Ctrl+]`   | 補完確定して入力継続           |

---

## Lazygit

### ブランチビュー

| キーマップ | 説明                               |
| ---------- | ---------------------------------- |
| `]`        | 次のタブ（ローカル→リモート→タグ） |
| `[`        | 前のタブ（タグ→リモート→ローカル） |

### 全ブランチグラフ表示

| キーマップ | 説明                                       |
| ---------- | ------------------------------------------ |
| `a`        | 全ブランチログをグラフ表示（Statusパネル） |
| `+` を2回  | パネル最大化（Commitsパネル）              |
| `Ctrl+O`   | ビューログオプションメニュー               |

**注**: `showWholeGraph: true`設定で全ブランチを表示（VSCode Git Graphライク）

---

## 高度な機能

### Markdown

| キーマップ   | 説明                     | モード |
| ------------ | ------------------------ | ------ |
| `<leader>mp` | Markdownプレビュートグル | n      |
| `<leader>ms` | Markdownプレビュー停止   | n      |

### CSV表示

| キーマップ   | 説明                           | モード |
| ------------ | ------------------------------ | ------ |
| `<leader>cv` | CSV表示をトグル（通常/表形式） | n      |

**CSVテキストオブジェクト**:

- `if`: CSVフィールドの内側を選択（inner field）
- `af`: CSVフィールド全体を選択（a field）

### システム設定

| キーマップ   | 説明                           | モード |
| ------------ | ------------------------------ | ------ |
| `<leader>l`  | Lazy（プラグインマネージャー） | n      |
| `<leader>L`  | LazyVim Changelog              | n      |
| `<leader>ui` | インデントガイドトグル         | n      |
| `<leader>ul` | 行番号トグル                   | n      |
| `<leader>uL` | 相対行番号トグル               | n      |
| `<leader>uw` | 折り返しトグル                 | n      |
| `<leader>uh` | インラインヒントトグル         | n      |

### ファイルタイプ設定

```vim
" ファイルタイプ確認・設定
:set filetype?
:set filetype=markdown
:set ft=javascript

" よく使うファイルタイプ
:set ft=typescript   " TypeScript
:set ft=json        " JSON
:set ft=yaml        " YAML
:set ft=go          " Go
:set ft=dockerfile  " Dockerfile
:set ft=text        " プレーンテキスト
```

### Serena（コーディングエージェント）

#### Claude Codeへの追加

```bash
# プロジェクトディレクトリで実行
claude mcp add serena -s project -- uvx --from git+https://github.com/oraios/serena serena start-mcp-server --context ide-assistant --project $(pwd)
```

#### 使用方法

1. Claude Code起動
2. `/mcp`でSerenaサーバー確認
3. オンボーディング開始：
    ```
    Serena のオンボーディングを開始してください。
    ```

---

## 参考リンク

- [LazyVim公式キーマップ](https://www.lazyvim.org/keymaps)
- [Serena GitHub](https://github.com/oraios/serena)
- [Serena解説記事](https://azukiazusa.dev/blog/serena-coding-agent/)

**最終更新**: 設定変更時にこのドキュメントも更新してください
